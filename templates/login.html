<!DOCTYPE html>
<html>
<head>
	 <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js">
  </script>
<link rel="stylesheet" type="text/css" href="{{url_for('static',filename='bootstrap.css')}}">
<link rel="stylesheet" type="text/css" href="{{url_for('static',filename='style.css')}}">
<script src="//apis.google.com/js/platform.js?onload=start"> </script>
</head>
<body>
	<!-- GOOGLE PLUS SIGN IN BUTTON-->
	
          <div id="signInButton">
          <span class="g-signin"
            data-scope="openid email"
            data-clientid="192682633442-ii5jher0k36nrq1dq4e9bgpo1qaj96o5.apps.googleusercontent.com"
            data-redirecturi="postmessage"
            data-accesstype="offline" 
            data-cookiepolicy="single_host_origin"
            data-callback="signInCallback"
            data-approvalprompt="force">
          </span>
        </div>
<!-- offline =access user even whe n the user is offline -->

<div id="result"></div>
<script>
	function signInCallback(authResult){
		if(authResult['code']){
			//hide sign in button now that the user is authorized
			$('#signInButton').attr('style','display:none');
			//send the one time use code to the server if the server responds write a login successfull message and return back to the FoodApp page
			window.console.log(authResult['code'])
			$.ajax({
				type : 'POST',
				url : '/gconnect?state={{STATE}}',
				processData: false,
				data : authResult['code'],
				contentType: 'application/octet-stream; charset=utf-8',
				success: function(result){
					if(result){
						$('#result').html('Login successfull!<br>'+result+'<br> redirecting....');
						setTimeout(function(){
							window.location.href = "/cuisines";
						},4000);

					}
					else if(authResult['error']){
						console.log('there was an error:'+ authResult['error']);
					}
					else{
						$('#result').html('Failed to make a server-side call.Check your configuration and console ');
					}
				}
			});
		}	
	}
	
</script>

<section class= "default">
	<p><button id="login-btn">Login</button><button id ="Signup-btn">SignUp</button></p>
	</hr>
	<div id="login">
	<form name="Login" id="loginform" action="" method="post"> 
		<p><label>username : </label></p>
			<input type="text" name="email" maxlength="50" name>
		<p><label>password : </label></p>
		<input type="password" name="password" >
		<p><button type="submit">Login</button></p>	
	</form>
	</div>
	<div id="Signup">
	<form id="ajaxform" action="/signup?state={{STATE}}" method = "post">
		<p><label>username : </label></p>
			<input type="text" name="email" maxlength="50">
		<p>Name</p>
		<input type="text" name="username" maxlength="50">	
		<p><label>password : </label></p>
		<input type="password" name="password" >

		<p><input type="submit" name="button" value="Sign Up"></p>
	</form>
	</div>
</section>
<script>
	(function(){
		$('#login').show();
		$('#Signup').hide();
		
	})();
	$('#login-btn').click(function(){
			$('#login').show();
			$('#Signup').hide();
		});
	$('#Signup-btn').click(function(){
			$('#login').hide();
			$('#Signup').show();
		});

	function checkInputs(input) {
		var flag = false;
	    input.each(function(){
	        var input = $(this); 
	        if( $.trim(input.val()) === '' ) {
	        	console.log($.trim(input.val()) === '');
	 	            flag = true;
	        } 
	    });
	    return flag;	
	}
	$('#loginform').submit(function(event)
	{
		$('#signInButton').attr('style','display:none');
		event.preventDefault();
		if(checkInputs($("#loginform :input[type=text]")))
		{
			alert("fill all the inputs!!!");
			return false;
		}
		data  = {};
		$.map($('#loginform').serializeArray(),function(ele,index){
			data[ele["name"]] = ele["value"];

		});
		$.ajax({
			type : 'POST',
			url : '/login?state={{STATE}}',
			processData:false,
			data :JSON.stringify(data),
			contentType: 'application/ajax; charset=utf-8',
			success:function(result)
			{
				if(result)
				{
					$('#Signup').hide();
					$('#login').hide();
					$('#result').html("Sign up successfull!!<br>"+result+"redirecting..");
					
					setTimeout(function(){
							window.location.href = "/cuisines";
						},2000);
				}
				else
				{
					$('#result').html("Invalid Credentials!!");
				}
			}
		});
	});	
	$('#ajaxform').submit(function(event)
	{
		$('#signInButton').attr('style','display:none');
		event.preventDefault();
		
		if (checkInputs($("#ajaxform :input[type=text]")))
		{
			alert("Fill all th inputs!!");
			return false;
		}

		data  = {};
		$.map($('#ajaxform').serializeArray(),function(ele,index){
			data[ele["name"]] = ele["value"];
		});

		$.ajax({
			type : 'POST',
			url : '/signup?state={{STATE}}',
			processData:false,
			data :JSON.stringify(data),
			contentType: 'application/ajax; charset=utf-8',
			success:function(result)
			{
				if(result)
				{
					$('#Signup').hide();
					$('#login').hide();
					$('#result').html("Sign up successfull!!<br>"+result+"redirecting..");
					
					setTimeout(function(){
							window.location.href = "/cuisines";
						},2000);
				}
				else
				{
					$('#result').html("Please Try Again!!");
				}
			}
		});
	});	
</script>

</body>
</html>